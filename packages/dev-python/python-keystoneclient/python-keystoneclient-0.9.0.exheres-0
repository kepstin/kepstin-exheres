# Copyright 2014 Calvin Walton <calvin.walton@kepstin.ca>
# Distributed under the terms of the GNU General Public License v2

# 3.4 is masked because of missing mox3 support
require pypi setup-py [ import=setuptools blacklist="3.1 3.2 3.4" has_bin=true ]

SUMMARY="Python bindings to the OpenStack Identity API (Keystone)"
DESCRIPTION="
This is a client for the OpenStack Identity API, implemented by Keystone.
There's a Python API (the \"keystoneclient\" module), and a command-line
script (\"keystone\").
"
HOMEPAGE="http://docs.openstack.org/developer/python-keystoneclient/"

LICENCES="Apache-2.0"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-python/pbr[>=0.6&<1.0][python_abis:*(-)?]
        !dev-python/pbr[=0.7*] [[ resolution = upgrade-blocked-before ]]
    build+run:
        dev-python/Babel[>=1.3][python_abis:*(-)?]
        dev-python/iso8601[>=0.1.9][python_abis:*(-)?]
        dev-python/netaddr[>=0.7.6][python_abis:*(-)?]
        dev-python/oslo-config[>=1.2.0][python_abis:*(-)?]
        dev-python/PrettyTable[>=0.7&<0.8][python_abis:*(-)?]
        dev-python/requests[>=1.1][python_abis:*(-)?]
        dev-python/six[>=1.6.0][python_abis:*(-)?]
    test:
        dev-python/fixtures[>=0.3.14][python_abis:*(-)?]
        dev-python/httpretty[>=0.8.0][python_abis:*(-)?]
        dev-python/mock[>=1.0][python_abis:*(-)?]
        dev-python/mox3[>=0.7.0][python_abis:*(-)?]
        dev-python/oauthlib[>=0.6&<0.6.2][python_abis:*(-)?] [[
            note = [ 0.6.2 changed the get_oauth_params api ] ]]
        dev-python/pycrypto[>=2.6][python_abis:*(-)?]
        dev-python/stevedore[>=0.14][python_abis:*(-)?]
        dev-python/testtools[>=0.9.34][python_abis:*(-)?]
        dev-python/testresources[>=0.2.4][python_abis:*(-)?]
        dev-python/WebOb[>=1.2.3][python_abis:*(-)?]
"

# With distro dependency handling, pip support is not needed.
# See http://docs.openstack.org/developer/pbr/packagers.html#dependencies
export SKIP_PIP_INSTALL=1

setup-py_test_one_multibuild() {
    PYTHONPATH="$(ls -d ${PWD}/build/lib*)" edo ${PYTHON} -B -m testtools.run \
        discover ./keystoneclient/tests
}

