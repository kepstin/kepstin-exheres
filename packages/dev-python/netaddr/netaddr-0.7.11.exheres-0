# Copyright 2014 Calvin Walton <calvin.walton@kepstin.ca>
# Distributed under the terms of the GNU General Public License v2

require pypi setup-py [ import=distutils ]

SUMMARY="Pythonic manipulation of IPv4, IPv6, CIDR, EUI and MAC network addresses"
DESCRIPTION="
A pure Python network address representation and manipulation library.

netaddr provides a Pythonic way of working with :
  * IPv4 and IPv6 addresses and subnets
  * MAC addresses, OUI and IAB identifiers, IEEE EUI-64 identifiers
  * arbitrary (non-aligned) IP address ranges and IP address sets
  * various non-CIDR IP range formats such as nmap and glob-style formats
"
HOMEPAGE="http://github.com/drkjam/netaddr/"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES=""

BUGS_TO=""

DEFAULT_SRC_PREPARE_PATCHES=(
    "${FILES}"/${PNV}-tests-return-code.diff
)

setup-py_test_one_multibuild() {
    case $(python_get_abi) in
    3.*)
        if [[ $(locale charset) != UTF-8 ]]; then
            einfo "Python3 tests fail unless running in a UTF-8 locale"
        else
            PYTHONPATH="$(ls -d ${PWD}/build/lib*)" edo ${PYTHON} -B netaddr/tests/__init__.py
        ;;
    *)
        PYTHONPATH="$(ls -d ${PWD}/build/lib*)" edo ${PYTHON} -B netaddr/tests/__init__.py
        ;;
}

