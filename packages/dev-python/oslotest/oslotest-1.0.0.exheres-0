# Copyright 2014 Calvin Walton <calvin.walton@kepstin.ca>
# Distributed under the terms of the GNU General Public License v2

require pypi
require setup-py [ import=setuptools ]

SUMMARY="OpenStack test framework and test fixtures"
HOMEPAGE="http://docs.openstack.org/developer/oslotest/"

LICENCES="Apache-2.0"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-python/pbr[python_abis:*(-)?]
    build+run:
        dev-python/fixtures[>=0.3.14][python_abis:*(-)?]
        dev-python/testscenarios[>=0.4][python_abis:*(-)?]
        dev-python/testtools[>=0.9.34][python_abis:*(-)?]
        dev-python/mock[>=1.0][python_abis:*(-)?]
        dev-python/mox3[python_abis:*(-)?]
        python_abis:2.7? ( dev-python/mox )
"

# With distro dependency handling, pip support is not needed.
# See http://docs.openstack.org/developer/pbr/packagers.html#dependencies
export SKIP_PIP_INSTALL=1

setup-py_test_one_multibuild() {
    # Test command adapted from the .testr.conf file
    PYTHONPATH="$(ls -d ${PWD}/build/lib*)" edo ${PYTHON} -B -m testtools.run \
        discover -t ./ .
}

